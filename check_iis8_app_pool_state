<#
Ester Niclos Ferreras

OK	UP
WARNING	UP or DOWN/UNREACHABLE*
CRITICAL	DOWN/UNREACHABLE
UNKNOWN	DOWN/UNREACHABLE


#>


#
# Shell arguments
#
[CmdletBinding()]
Param(
  [Parameter(Mandatory=$True,Position=1)]
   [string]$ApplicationPool
   )

Set-Variable OK 0 -option Constant
Set-Variable WARNING 1 -option Constant
Set-Variable CRITICAL 2 -option Constant
Set-Variable UNKNOWN 3 -option Constant


#
# ASK STATUS
#

$servermanager = [Microsoft.Web.Administration.ServerManager]::OpenRemote("localhost")
$apppools = $servermanager.ApplicationPools["$ApplicationPool"]
$status = $apppools.state

$iis=get-itemproperty HKLM:\SOFTWARE\Microsoft\InetStp\  | select setupstring


  $resultstring='IISPOOL UNKNOWN ' + $ApplicationPool + ' ' + $status +' ; ' + $iis.SETUPSTRING + ' ' 
  $exit_code = $UNKNOWN
  
  if ($status -eq 'Started')
{
   $resultstring='IISPOOL OK '+  $ApplicationPool + ' ' + $status +' ; ' + $iis.SETUPSTRING + ' ' 
   $exit_code = $OK
}

Write-Host $resultstring
exit $exit_code

